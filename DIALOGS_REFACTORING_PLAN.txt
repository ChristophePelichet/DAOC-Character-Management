================================================================================
DIALOGS.PY REFACTORING PLAN
================================================================================
File: UI/dialogs.py
Date: 13 December 2025
Updated: 19 December 2025 (Phase 1-8 Complete - v0.109 Refactoring Merge)
Purpose: Extract functions to dedicated modules for better maintainability
================================================================================

COMPLETED PHASES
================================================================================

âœ… PHASE 1: TEMPLATE PARSING (COMPLETED - v0.109)
================================================================================
Target File: Functions/template_parser.py (1392 lines)
Extracted: 8 functions from ArmorManagementDialog class
Removed from dialogs.py: 1381 lines
Date Completed: 18 December 2025
Branch: refactor/v0.109-dialogs-cleanup

Extracted Functions:
1. âœ… template_parse() - Main entry point for template parsing
2. âœ… template_detect_format() - Loki/Zenkcraft format detection
3. âœ… template_parse_loki() - Parse Loki format templates with full layout
4. âœ… template_parse_zenkcraft() - Parse Zenkcraft format templates
5. âœ… template_get_item_price() - Multi-source price lookup
6. âœ… template_format_item_with_price() - Item display formatting with icons
7. âœ… template_merge_columns() - 2-column layout with proper alignment
8. âœ… template_strip_color_markers() - Remove color markers for width calculation

Quality Metrics:
- PEP 8 compliant (line length <88 chars, type hints, docstrings)
- No hardcoded strings (all UI text uses lang.get())
- No French comments (English only in code)
- Complete documentation in ARMORY_TECHNICAL_DOCUMENTATION.md
- Full error handling with graceful degradation

Status: READY FOR PRODUCTION

---

âœ… PHASE 2: ITEM PRICE MANAGEMENT (COMPLETED - v0.109)
================================================================================
Target File: Functions/items_price_manager.py (205 lines)
Extracted: 2 functions from ArmorManagementDialog class
Date Completed: 18 December 2025
Branch: feature/v0.109-dialogs-phase-2-item-prices

Extracted Functions:
1. âœ… items_price_sync_template() - Sync template prices with database
   - Removes duplicate prices from JSON when found in DB
   - Ensures database is single source of truth
   - Returns count of items synced
   
2. âœ… items_price_find_missing() - Find items without prices in template
   - Searches both database and metadata for prices
   - Returns list of items missing prices
   - Includes detailed status for each item

Quality Metrics:
- PEP 8 compliant (line length <88 chars, all lines verified)
- No hardcoded strings (no user-facing text in module)
- No French comments (English-only docstrings and comments)
- Complete type hints and documentation
- Proper error handling with logging
- Syntax validation: PASSED
- Integration testing: PASSED

UI Integration:
- dialogs.py methods kept as thin wrappers for backward compatibility
- _sync_template_prices_with_db() calls items_price_sync_template()
- search_missing_prices() UI logic remains in dialogs.py (UI concern)

Status: INTEGRATION COMPLETE - MERGED AND INTEGRATED

---

âœ… PHASE 3: RUFF COMPLIANCE CLEANUP (COMPLETED - v0.109)
================================================================================
Target File: UI/dialogs.py
Date Completed: 18 December 2025
Branch: refactor/v0.109-fix-template-parser-ruff

Issues Fixed:
1. âœ… 19 E722 errors (bare except) â†’ except Exception:
2. âœ… 2 F841 errors (unused variables) â†’ removed
3. âœ… 1 F823 error (missing import) â†’ added import
4. âœ… 4 pre-extraction errors:
   - QSlider import (F401) - removed unused
   - items_price_find_missing import (F401) - removed unused  
   - f-string without placeholder (F541) - removed f prefix
   - bare except clauses - converted to except Exception:

Quality Metrics:
- Ruff checks: 0 errors (ignoring E501)
- Syntax validation: PASSED
- All HTML F-strings preserved (ignored per requirements)

Status: INTEGRATION COMPLETE - MERGED AND INTEGRATED

---

âœ… PHASE 4: CHARACTER VALIDATOR EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/character_validator.py (280 lines)
Extracted: 7 functions from CharacterSheetWindow class
Date Completed: 18 December 2025
Branch: refactor/v0.109-character-validator-extraction

Extracted Functions:
1. âœ… character_get_classes_for_realm(data_manager, realm)
   - Retrieves classes available for specified realm
   - Returns list of class dictionaries with translations

2. âœ… character_get_races_for_class(data_manager, realm, class_name=None)
   - Retrieves races for realm, optionally filtered by class
   - Supports realm-class combination validation

3. âœ… character_populate_classes_combo(combo_widget, data_manager, realm)
   - Populates QComboBox with translated class names
   - Stores actual class name as item data

4. âœ… character_populate_races_combo(combo_widget, data_manager, realm, class_name=None)
   - Populates QComboBox with translated race names
   - Filters by class if specified

5. âœ… character_handle_realm_change(combo_realm, combo_class, combo_race, data_manager, character_data)
   - Handles realm dropdown changes with cascade updates
   - Updates both class and race dropdowns automatically
   - Updates character_data

6. âœ… character_handle_class_change(combo_class, combo_race, data_manager, realm, character_data)
   - Handles class dropdown changes
   - Filters race dropdown to valid combinations
   - Updates character_data

7. âœ… character_handle_race_change(combo_race, character_data)
   - Handles race dropdown changes
   - Updates character_data with new race

Quality Metrics:
- PEP 8 compliant (ruff validation: 0 errors, ignoring E501)
- No hardcoded strings (uses config.get("ui.language") for all UI text)
- No French comments (100% English docstrings and comments)
- Complete type hints and comprehensive docstrings
- Proper error handling with logging
- Syntax validation: PASSED
- Multi-language support (EN/FR/DE) for display names

UI Integration:
- Thin wrapper methods in CharacterSheetWindow (minimal logic)
- _populate_classes_sheet() â†’ character_populate_classes_combo()
- _populate_races_sheet() â†’ character_populate_races_combo()
- _on_realm_changed_sheet() â†’ character_handle_realm_change()
- _on_class_changed_sheet() â†’ character_handle_class_change()
- _on_race_changed_sheet() â†’ character_handle_race_change()
- Banner updates kept in dialogs.py (UI concern)

Removed from dialogs.py: ~80 lines of business logic
Code added to character_validator.py: ~280 lines

Status: INTEGRATION COMPLETE - READY FOR COMMIT

---

âœ… PHASE 5: CHARACTER REALM RANK CALCULATOR EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/character_rr_calculator.py (209 lines)
Extracted: 3 functions from CharacterSheetWindow class
Date Completed: 18 December 2025
Branch: refactor/v0.109-realm-rank-extraction

Extracted Functions:
1. âœ… character_rr_get_valid_levels(rank)
   - Get valid level range for a given realm rank
   - Rank 1: levels 0-10, Ranks 2-14: levels 0-9
   - Returns list of valid level numbers

2. âœ… character_rr_calculate_points_info(data_manager, realm, rank, level)
   - Get progression information to next rank level
   - Returns: current_points, next_points, percentage, level_str

3. âœ… character_rr_calculate_from_points(data_manager, realm, realm_points)
   - Calculate rank/level from realm points
   - Normalizes string input and handles fallback

Quality Metrics:
- PEP 8 compliant (ruff: 0 errors)
- No hardcoded strings
- No French comments (100% English)
- Complete type hints and docstrings
- Syntax validation: PASSED

UI Integration:
- Thin wrappers in CharacterSheetWindow
- update_level_dropdown() â†’ character_rr_get_valid_levels()
- update_rp_info() â†’ character_rr_calculate_points_info()
- update_rank_display() â†’ character_rr_calculate_from_points()

Removed from dialogs.py: ~50 lines
Code added to character_rr_calculator.py: ~209 lines

Status: INTEGRATION COMPLETE - READY FOR COMMIT

---

âœ… PHASE 6: CHARACTER HERALD SCRAPPER EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/character_herald_scrapper.py (422 lines)
Extracted: 4 functions from CharacterSheetWindow class
Date Completed: 19 December 2025
Branch: refactor/v0.109-herald-scraping-extraction

Extracted Functions:
1. âœ… character_herald_update(parent_window, url)
   - Main entry point for complete character update from Herald
   - Validates Herald URL, launches CharacterUpdateThread
   - Shows progress dialog with CHARACTER_UPDATE steps
   - Thin wrapper: 4 lines in dialogs.py

2. âœ… character_herald_update_rvr_stats(parent_window, url)
   - Fast update for RvR statistics only
   - Launches lighter StatsUpdateThread
   - Shows progress dialog with STATS_SCRAPING steps
   - Thin wrapper: 4 lines in dialogs.py

3. âœ… character_herald_apply_scraped_stats(parent_window, result_rvr, result_pvp, result_pve, result_wealth, result_achievements)
   - Apply all scraped stats to UI and character_data
   - Updates RvR, PvP, PvE, wealth, and achievements fields
   - Thin wrapper: 3 lines in dialogs.py

4. âœ… character_herald_apply_partial_stats(parent_window, result_rvr, result_pvp, result_pve, result_wealth, result_achievements)
   - Apply selective stats to UI and character_data
   - Only updates if result_*['success'] is True
   - Saves character data after each update
   - Thin wrapper: 3 lines in dialogs.py

Quality Metrics:
- âœ… PEP 8 compliant
- âœ… Type hints present
- âœ… Docstrings comprehensive with examples
- âœ… Error handling robust (URL validation, thread-safe)
- âœ… No hardcoded strings (uses lang.get())
- âœ… No French comments (100% English)
- âœ… Syntax validation: PASSED

Code Structure:
- Created character_herald_scrapper.py: ~422 lines
- Updated dialogs.py: ~14 lines of thin wrappers
- Removed from dialogs.py: ~130 lines of business logic
- Net result: ~116 lines saved, improved modularity

Status: READY FOR PRODUCTION - MERGE TO DIALOGS-CLEANUP

---

âœ… PHASE 7: CHARACTER BANNER MANAGEMENT EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/character_banner.py (141 lines)
Extracted: 2 functions from CharacterSheetWindow class
Date Completed: 19 December 2025
Branch: refactor/v0.109-banner-management

Extracted Functions:
1. âœ… banner_load_class_image(parent_window, realm, class_name)
   - Load and display class banner image from Img/Banner/{realm}/{class}.jpg
   - Falls back to .png if .jpg not found
   - Shows placeholder if image invalid or missing
   - Supports realm name mapping (Albionâ†’Alb, Hiberniaâ†’Hib, Midgardâ†’Mid)
   - Thin wrapper: 3 lines in dialogs.py

2. âœ… banner_set_placeholder(parent_window, text)
   - Display styled placeholder text when banner unavailable
   - Uses scaled font size based on UI theme
   - Applies gray italic styling
   - Thin wrapper: 1 line in dialogs.py

Quality Metrics:
- âœ… PEP 8 compliant (ruff checks: 0 errors)
- âœ… Type hints complete
- âœ… Docstrings comprehensive with examples
- âœ… Error handling robust (file validation, logging)
- âœ… No hardcoded strings (uses lang.get())
- âœ… No French comments (100% English)
- âœ… Syntax validation: PASSED

Code Structure:
- Created character_banner.py: ~141 lines
- Updated dialogs.py: ~4 lines of thin wrappers
- Removed from dialogs.py: ~54 lines of business logic
- Net result: ~50 lines saved, improved modularity

Status: READY FOR PRODUCTION - MERGE TO DIALOGS-CLEANUP

---

âœ… PHASE 8: HERALD URL VALIDATION EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/herald_url_validator.py (236 lines)
Extracted: 4 functions from CharacterSheetWindow class
Date Completed: 19 December 2025
Branch: refactor/v0.109-herald-url-validation

Extracted Functions:
1. âœ… herald_url_on_text_changed(parent_window, text)
   - Validate Herald URL field and update button states
   - Enables/disables update_rvr_button based on URL validity
   - Checks if Herald scraping is in progress (return if true)
   - Sets appropriate tooltips via lang.get()
   - Thin wrapper: 2 lines in dialogs.py

2. âœ… herald_url_open_url(parent_window)
   - Open Herald URL in browser with authentication cookies
   - Validates URL is not empty (shows warning if missing)
   - Adds protocol (https://) if not present
   - Launches browser in separate thread to prevent UI blocking
   - Handles errors with QMessageBox
   - Thin wrapper: 1 line in dialogs.py

3. âœ… _herald_url_open_in_thread(url)
   - Internal: Open Herald URL with cookies in separate thread
   - Uses CookieManager for authenticated session
   - Logs errors without raising exceptions (thread-safe)
   - Daemon thread execution

4. âœ… herald_url_update_button_states(parent_window)
   - Update Herald button states based on validation and scraping status
   - Checks if Eden validation is running
   - Disables buttons if validation in progress or scraping active
   - Updates tooltips based on state
   - State matrix: validation/URL/scraping combinations
   - Thin wrapper: 1 line in dialogs.py

Quality Metrics:
- âœ… PEP 8 compliant (ruff checks: 0 errors)
- âœ… Type hints complete for all parameters
- âœ… Comprehensive docstrings with examples and process flow
- âœ… No hardcoded strings (all messages use lang.get() with defaults)
- âœ… No French comments (100% English docstrings and comments)
- âœ… Error handling robust (validation, UI feedback, logging)
- âœ… Thread-safe execution (no race conditions)
- âœ… Syntax validation: PASSED

Code Structure:
- Created herald_url_validator.py: ~236 lines
- Updated dialogs.py: ~4 lines of thin wrappers
- Removed from dialogs.py: ~126 lines of business logic
- Net result: ~122 lines saved, improved modularity

Integration Points:
- herald_url_on_text_changed(): Called on herald_url_edit.textChanged signal
- herald_url_open_url(): Called on open_herald_button.clicked signal
- herald_url_update_button_states(): Called from multiple places (validation, scraping state changes)

Documentation:
- Added to EDEN_TECHNICAL_DOCUMENTATION.md under "UI Integration" section
- Complete function signatures, behavior, error handling, integration points
- State matrix for button management

Status: READY FOR PRODUCTION - MERGE TO DIALOGS-CLEANUP

---

âœ… PHASE 9: ARMOR UPLOAD & MANAGEMENT EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/armor_upload_handler.py (362 lines)
Extracted: 4 functions from ArmorManagementDialog class
Date Completed: 19 December 2025
Branch: refactor/v0.109-armor-upload-preview

Extracted Functions:
1. âœ… armor_upload_file(parent_window, armor_manager, season, character_name, realm)
   - Open file dialog and upload armor with cross-season support
   - Shows preview dialog for filename/season confirmation
   - Creates target ArmorManager if season differs
   - All messages use lang.get() for i18n
   - Thin wrapper: 1 line in dialogs.py

2. âœ… armor_import_template(parent_window, character_data, data_manager, template_manager)
   - Open template import dialog with class validation
   - Retrieves class translations (FR, DE)
   - Launches TemplateImportDialog with refresh signal
   - Thin wrapper: 4 lines in dialogs.py

3. âœ… armor_open_file(parent_window, template_manager, realm, filename)
   - Open armor file with system default application
   - Cross-platform support (Windows/macOS/Linux)
   - Validates file exists before opening
   - Thin wrapper: 1 line in dialogs.py

4. âœ… armor_delete_file(parent_window, template_manager, realm, filename)
   - Delete armor file after user confirmation
   - Shows success/error messages with i18n
   - Refreshes UI on successful deletion
   - Thin wrapper: 1 line in dialogs.py

Quality Metrics:
- âœ… PEP 8 compliant (ruff checks: 0 errors)
- âœ… Type hints complete for all parameters
- âœ… Comprehensive docstrings with examples and process flow
- âœ… No hardcoded strings (all use lang.get() with defaults)
- âœ… No French comments (100% English docstrings and comments)
- âœ… Error handling robust (validation, UI feedback, logging)
- âœ… Proper imports and integration points
- âœ… Syntax validation: PASSED

Code Structure:
- Created armor_upload_handler.py: ~362 lines
- Updated dialogs.py: ~7 lines of thin wrappers
- Removed from dialogs.py: ~212 lines of business logic
- Net result: ~205 lines saved, improved modularity

Integration Points:
- armor_upload_file(): Called from upload_armor() button handler
- armor_import_template(): Called from import_template() button handler
- armor_open_file(): Called from context menu for file opening
- armor_delete_file(): Called from context menu for file deletion

Status: READY FOR PRODUCTION - MERGE TO DIALOGS-CLEANUP

---

âœ… PHASE 10: ITEM MODEL VIEWER EXTRACTION (COMPLETED - v0.109)
================================================================================
Target File: Functions/item_model_viewer.py (167 lines)
Extracted: 2 functions from ArmorManagementDialog class
Date Completed: 19 December 2025
Branch: refactor/v0.109-item-model-viewer

Extracted Functions:
1. âœ… item_model_on_link_clicked(parent_window, url)
   - Handle click on model viewer link in preview
   - Validates URL scheme is "model" (custom protocol)
   - Calls item_model_show() to display model
   - Prevents default link navigation
   - Thin wrapper: 1 line in dialogs.py

2. âœ… item_model_show(parent_window, item_name)
   - Display model image for the specified item
   - Multi-source search: direct â†’ realm-specific â†’ all realms
   - Supports both 'model_id' and 'model' database fields
   - Creates and displays ModelViewerDialog (non-modal)
   - Shows error message if model not found
   - Thin wrapper: 1 line in dialogs.py

Quality Metrics:
- âœ… PEP 8 compliant (ruff checks: 0 errors)
- âœ… Type hints complete for all parameters
- âœ… Comprehensive docstrings with examples and process flow
- âœ… No hardcoded strings (all use lang.get() with defaults)
- âœ… No French comments (100% English docstrings and comments)
- âœ… Error handling robust (validation, UI feedback, logging)
- âœ… Syntax validation: PASSED

Code Structure:
- Created item_model_viewer.py: ~167 lines
- Updated dialogs.py: ~2 lines of thin wrappers
- Removed from dialogs.py: ~60 lines of business logic
- Net result: ~58 lines saved, improved modularity

Integration Points:
- item_model_on_link_clicked(): Connected to preview_area.anchorClicked signal
- item_model_show(): Called from item_model_on_link_clicked() and other locations

Documentation:
- Updated MODELS_VISUAL_SYSTEM_DOCUMENTATION.md with Phase 10 section (v3.0)
- Updated ARMORY_TECHNICAL_DOCUMENTATION.md (v3.0 â†’ v3.1)
- Reference to item_model_viewer module added

Status: READY FOR PRODUCTION - MERGE TO DIALOGS-CLEANUP

---

FUTURE PHASES (NOT STARTED)
================================================================================

PHASE 11: ACHIEVEMENTS DISPLAY (Low Priority)
Current Location: CharacterSheetWindow class
Target File: Functions/achievement_formatter.py
Naming Convention: achievement_{action}_{object}

Functions to Extract:
1. _update_achievements_display() - Format and display achievements list

---

EXTRACTION SUMMARY
================================================================================

Total Phases: 11 (10 completed, 1 future)
Completed Phases: 10
- Phase 1: âœ… COMPLETE (Template Parser - 1392 lines)
- Phase 2: âœ… COMPLETE (Item Price Manager - 205 lines)
- Phase 3: âœ… COMPLETE (Ruff Cleanup - 22 errors fixed)
- Phase 4: âœ… COMPLETE (Character Validator - 280 lines)
- Phase 5: âœ… COMPLETE (Character RR Calculator - 209 lines)
- Phase 6: âœ… COMPLETE (Character Herald Scrapper - 422 lines)
- Phase 7: âœ… COMPLETE (Character Banner Management - 141 lines)
- Phase 8: âœ… COMPLETE (Herald URL Validation - 236 lines)
- Phase 9: âœ… COMPLETE (Armor Upload & Management - 362 lines)
- Phase 10: âœ… COMPLETE (Item Model Viewer - 167 lines)

Future Phases: 1
- Phase 11: Achievements Display (Low Priority)

Total Lines Extracted: ~2706 lines
Total Thin Wrappers in dialogs.py: ~156 lines
Net Reduction in dialogs.py: ~2550 lines
Total Modules Created: 9 dedicated modules
Quality: All modules PEP 8 compliant with 0 errors


GROUP 12: CHARACTER RENAMING (Low Priority)
================================================================================
Current Location: CharacterSheetWindow class
Target File: Functions/character_rename_handler.py
Naming Convention: character_{action}_{object}

35. Function: rename_character()
    Purpose: Rename character with validation
    Lines: ~2126-2174
    New Name: character_rename_with_validation()
    Notes: Validates name, updates JSON file


GROUP 13: WORKER THREAD MANAGEMENT (Medium Priority)
================================================================================
Current Location: Various classes
Target File: Functions/herald_workers.py
Naming Convention: Keep PascalCase for classes (QThread subclasses)

36. Class: HeraldScraperWorker
    Purpose: Background thread for Herald scraping
    Lines: ~37-58
    New Name: Keep as HeraldScraperWorker
    Notes: QThread subclass

37. Class: ConnectionTestThread
    Purpose: Test Eden Herald connection
    Lines: ~5058-5075
    New Name: Keep as ConnectionTestThread
    Notes: QThread subclass

38. Class: StatsUpdateThread
    Purpose: Update character stats from Herald
    Lines: ~6196-6423
    New Name: Keep as StatsUpdateThread
    Notes: QThread subclass with step progress

39. Class: CharacterUpdateThread
    Purpose: Full character update from Herald
    Lines: ~6425-6732
    New Name: Keep as CharacterUpdateThread
    Notes: QThread subclass with step progress


GROUP 13: COOKIE MANAGEMENT (Keep in dialogs.py)
================================================================================
Note: CookieManagerDialog is complex UI, keep in dialogs.py
Lines: ~5077-5659


GROUP 14: SEARCH FUNCTIONALITY (Keep in dialogs.py)
================================================================================
Note: SearchThread and HeraldSearchDialog are tightly coupled to UI
Lines: ~5870-6194, ~6734-7590


GROUP 15: BACKUP SETTINGS (Keep in dialogs.py)
================================================================================
Note: BackupSettingsDialog is UI-heavy, keep in dialogs.py
Lines: ~7858-8446


GROUP 16: SIMPLE UTILITY FUNCTIONS (Low Priority)
================================================================================
Target File: Functions/ui_utils.py
Naming Convention: ui_{action}_{object}

40. Function: show_context_menu()
    Purpose: Show context menu for armor list
    Lines: ~4801-4835
    New Name: ui_create_armor_context_menu()
    Notes: Creates QMenu with actions


================================================================================
IMPLEMENTATION STRATEGY
================================================================================

================================================================================
IMPLEMENTATION PROGRESS
================================================================================

PHASE 1 - Template Parsing (COMPLETED âœ…)
================================================================================
Status: COMPLETED (18 Dec 2025)
File: Functions/template_parser.py (1272 lines created)
Cleaned from UI/dialogs.py: 1381 lines removed
Branch: refactor/v0.109-dialogs-phase-1-template-parser

Functions Extracted:
  âœ… template_parse() - Main entry point
  âœ… template_detect_format() - Format detection
  âœ… template_parse_loki() - Loki format parsing
  âœ… template_parse_zenkcraft() - Zenkcraft format parsing + equipment
  âœ… template_get_item_price() - Price lookup
  âœ… template_format_item_with_price() - Price formatting
  âœ… template_merge_columns() - 2-column layout
  âœ… template_strip_color_markers() - Width calculation helper

Result: All template parsing logic now in dedicated module (PEP 8 compliant)

---

PHASE 1b - Stats/Skills/Resistances/Bonuses Extraction (IN PROGRESS ðŸ”„)
================================================================================
Status: IN PROGRESS (Feature branch: feature/v0.110-dialogs-phase-2-stats-skills)
Target: Extract stats/skills/resistances/bonuses section to dedicated function
Expected lines to remove: ~250-350 from dialogs.py

Functions to Create/Refactor:
  â–¡ template_parse_zenkcraft_stats_section() - NEW
    Purpose: Separate stats/skills/resistances/bonuses parsing
    Input: stats, skills, resistances, bonuses dicts
    Output: Formatted HTML with 2-column layout
    Helper: Use existing template_merge_columns()
    
  â–¡ Refactor template_merge_columns() if needed for reusability
    Current users: template_parse_zenkcraft() calls it twice

Affected File: UI/dialogs.py
  - Remove stats/skills/resistances/bonuses inline code
  - Call template_parse_zenkcraft_stats_section()
  - Keep color logic consistent

---

PHASE 2 - Item Price Management (PLANNED ðŸ“‹)
================================================================================
Status: PENDING
Target File: Functions/item_price_manager.py
Naming Convention: price_* prefix

Functions:
  â–¡ price_sync_template() - Update prices in metadata JSON
  â–¡ price_find_missing_items() - Find items without prices

Expected Result: Dedicated price management module

---

PHASE 3 - Herald Integration (PLANNED ðŸ“‹)
================================================================================
Status: PENDING
Target Files: 
  - Functions/herald_integration.py (herald_* prefix)
  - Functions/herald_workers.py (worker threads)

---

PHASE 4 - Character Validation (PLANNED ðŸ“‹)
================================================================================
Status: PENDING
Target File: Functions/character_validator.py
Naming Convention: character_* prefix

---

PHASE 5 - Realm Rank & Achievements (PLANNED ðŸ“‹)
================================================================================
Status: PENDING
Target Files:
  - Functions/realm_rank_calculator.py (realm_rank_* prefix)
  - Functions/achievement_formatter.py (achievement_* prefix)

---

PHASE 6 - Armor & Model Viewer (PLANNED ðŸ“‹)
================================================================================
Status: PENDING
Target Files:
  - Functions/armor_upload_handler.py (armor_* prefix)
  - Functions/item_model_viewer.py (item_model_* prefix)

---

PHASE 7 - Misc Utilities (PLANNED ðŸ“‹)
================================================================================
Status: PENDING
Target Files:
  - Functions/character_banner.py (banner_* prefix)
  - Functions/herald_url_validator.py (herald_url_* prefix)
  - Functions/character_rename_handler.py (character_* prefix)
  - Functions/ui_utils.py (ui_* prefix)

================================================================================
PHASE 1 - Template Parsing (PRIORITY 1)
  â†’ Create Functions/template_parser.py
  â†’ Extract functions 1-8 (template parsing logic)
  â†’ All functions use template_* prefix
  â†’ Test with existing templates
  â†’ Update ArmorManagementDialog to use new module

PHASE 2 - Item Price Management (PRIORITY 2)
  â†’ Create Functions/item_price_manager.py
  â†’ Extract functions 9-10
  â†’ All functions use price_* prefix
  â†’ Test price sync and search

PHASE 3 - Herald Integration (PRIORITY 3)
  â†’ Create Functions/herald_integration.py
  â†’ Extract functions 19-22
  â†’ All functions use herald_* prefix
  â†’ Move worker threads to Functions/herald_workers.py (36-39)
  â†’ Test Herald scraping and updates

PHASE 4 - Character Validation (PRIORITY 4)
  â†’ Create Functions/character_validator.py
  â†’ Extract functions 11-15
  â†’ All functions use character_* prefix
  â†’ Test realm/class/race cascading

PHASE 5 - Realm Rank & Achievements (PRIORITY 5)
  â†’ Create Functions/realm_rank_calculator.py
  â†’ Extract functions 16-18
  â†’ All functions use realm_rank_* prefix
  â†’ Create Functions/achievement_formatter.py
  â†’ Extract function 34
  â†’ Use achievement_* prefix

PHASE 6 - Armor & Model Viewer (PRIORITY 6)
  â†’ Create Functions/armor_upload_handler.py
  â†’ Extract functions 28-31
  â†’ All functions use armor_* prefix
  â†’ Create Functions/item_model_viewer.py
  â†’ Extract functions 32-33
  â†’ Use item_model_* prefix

PHASE 7 - Misc Utilities (PRIORITY 7)
  â†’ Create Functions/character_banner.py (23-24) - banner_* prefix
  â†’ Create Functions/herald_url_validator.py (25-27) - herald_url_* prefix
  â†’ Create Functions/character_rename_handler.py (35) - character_* prefix
  â†’ Create Functions/ui_utils.py (40) - ui_* prefix


================================================================================
EXPECTED BENEFITS
================================================================================

1. Maintainability
   - Smaller, focused files (dialogs.py: 8765 â†’ ~4000 lines)
   - Clear separation of concerns
   - Easier to test individual functions

2. Reusability
   - Template parsing can be used by CLI tools
   - Herald integration reusable in automation scripts
   - Validation logic shared across dialogs

3. Performance
   - No performance impact (imports are cached)
   - Easier to profile specific functions
   - Better memory management

4. Testing
   - Each module can have dedicated unit tests
   - Mock external dependencies (DB, scraping)
   - Test edge cases in isolation

5. Documentation
   - Each module has focused docstrings
   - Technical documentation per feature
   - Examples in module docstrings


================================================================================
NOTES
================================================================================

- Keep all QDialog classes in dialogs.py (UI components)
- Move only business logic and utility functions
- Maintain backward compatibility (imports)
- Add proper docstrings to extracted functions
- Follow PEP 8 naming conventions
- Update tests after each phase
- Document each extraction in commit messages

================================================================================
END OF REFACTORING PLAN
================================================================================
